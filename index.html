<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Tap-Tap Buatan Taufiq</title>
    <style>
        body {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(45deg, #1a1a2e, #22223b, #4a4e69);
            color: #fff;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            animation: gradient 25s ease infinite;
            background-size: 200% 200%;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        #game-container {
            width: 800px;
            height: 600px;
            background: linear-gradient(135deg, #2c2c54, #3a506b);
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
            overflow: hidden;
            display: none;
            position: relative;
        }
        #menu, #mode-select {
            text-align: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.6);
            max-width: 600px;
        }
        #menu h1, #mode-select h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 0 0 8px rgba(0, 255, 255, 0.8);
        }
        #menu p {
            font-size: 16px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        #menu .developer {
            font-size: 14px;
            color: #c7ceea;
            margin-bottom: 20px;
            text-shadow: 0 0 6px rgba(0, 255, 255, 0.6);
        }
        #menu button, #mode-select button {
            padding: 15px 30px;
            margin: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        #menu button:hover, #mode-select button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
        }
        #loading-screen p {
            font-size: 24px;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.6);
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #fff;
            border-top: 5px solid #4ecdc4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #score-board, #timer {
            position: absolute;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 18px;
            text-shadow: 0 0 6px rgba(0, 0, 0, 0.5);
            animation: glow 1.5s infinite alternate;
        }
        @keyframes glow {
            from { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
            to { box-shadow: 0 0 10px rgba(255, 255, 255, 0.8); }
        }
        #score-board { top: 10px; left: 10px; }
        #timer { top: 10px; right: 10px; }
        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            display: none;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -60%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }
        .cat {
            position: absolute;
            background: url('https://img.icons8.com/emoji/100/000000/cat.png') no-repeat center;
            background-size: contain;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .cat.clicked {
            animation: boing 0.3s;
        }
        @keyframes boing {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        .distraction {
            position: absolute;
            background: url('https://img.icons8.com/emoji/50/000000/fox.png') no-repeat center;
            background-size: contain;
            cursor: pointer;
        }
        button {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            padding: 12px 24px;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.3s;
        }
        button:hover { transform: scale(1.05); }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }
        #fog {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.4);
            display: none;
        }
    </style>
</head>
<body>
    <div id="loading-screen">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>
    <div id="menu">
        <h1>Tap-Tap Kucing</h1>
        <p>Game Tap Tap Buatan Taufiq</p>
        <p class="developer">Dikembangkan oleh Mohammad Noor Taufiqilah, siswa kelas 12 di Nahmus tahun ini.</p>
        <p>Cara Bermain:<br>Klik kucing lucu yang bergerak di layar sebanyak mungkin untuk mengumpulkan poin sebelum waktu habis. Setiap klik memberikan 1 poin, dan kombo cepat memberikan poin ekstra. Kucing akan bergerak lebih cepat setiap klik! Hindari rubah yang bergerak di sekitar, karena mengkliknya mengurangi poin. Waspada dengan kabut yang mengganggu pandangan! Pilih mode (Easy, Medium, Impossible) dan raih skor tertinggi!</p>
        <button onclick="showModeSelect()">Start Game</button>
    </div>
    <div id="mode-select" style="display: none;">
        <h1>Pilih Mode</h1>
        <button onclick="startGame('easy')">Easy</button>
        <button onclick="startGame('medium')">Medium</button>
        <button onclick="startGame('impossible')">Impossible</button>
    </div>
    <div id="game-container">
        <canvas id="particle-canvas" width="800" height="600"></canvas>
        <div id="fog"></div>
        <div id="score-board">Skor: <span id="score">0</span></div>
        <div id="timer">Waktu: <span id="time">0</span>s</div>
        <div id="game-over">
            <h2>Game Over!</h2>
            <p>Skor Akhir: <span id="final-score">0</span></p>
            <button onclick="backToMenu()">Kembali ke Menu</button>
        </div>
    </div>

    <script>
        const gameContainer = document.getElementById("game-container");
        const menu = document.getElementById("menu");
        const modeSelect = document.getElementById("mode-select");
        const loadingScreen = document.getElementById("loading-screen");
        const scoreDisplay = document.getElementById("score");
        const timeDisplay = document.getElementById("time");
        const gameOverScreen = document.getElementById("game-over");
        const finalScoreDisplay = document.getElementById("final-score");
        const fog = document.getElementById("fog");
        const canvas = document.getElementById("particle-canvas");
        const ctx = canvas.getContext("2d");
        let score = 0;
        let timeLeft = 0;
        let gameActive = false;
        let distractions = [];
        let particles = [];
        let currentMode = null;
        let animationFrameId = null;
        let timerId = null;
        let distractionInterval = null;
        let fogInterval = null;
        let clickCount = 0;
        let lastClickTime = 0;
        let cat = null;
        let catData = { x: 400, y: 300, vx: 0, vy: 0, size: 0 };

        // Efek suara
        const clickSounds = [
            new Audio("https://freesound.org/data/previews/171/171671_2437358-lq.mp3"),
            new Audio("https://freesound.org/data/previews/456/456557_5123851-lq.mp3")
        ];
        const meowSound = new Audio("https://freesound.org/data/previews/203/203918_5123851-lq.mp3");
        const distractionSound = new Audio("https://freesound.org/data/previews/269/269290_5123851-lq.mp3");

        function playSound(sound) {
            if (sound) {
                sound.play().catch(error => console.warn("Audio play failed:", error));
            }
        }

        // Konfigurasi mode
        const modes = {
            easy: { time: 30, catSize: 150, distractionCount: 2, fogChance: 0.1, fogDuration: 2000, speed: 3 },
            medium: { time: 20, catSize: 120, distractionCount: 4, fogChance: 0.2, fogDuration: 3000, speed: 4 },
            impossible: { time: 10, catSize: 90, distractionCount: 6, fogChance: 0.3, fogDuration: 4000, speed: 5 }
        };

        // Tampilkan loading screen
        function showLoadingScreen(callback) {
            loadingScreen.style.display = "flex";
            setTimeout(() => {
                loadingScreen.style.display = "none";
                if (typeof callback === "function") callback();
            }, 1000);
        }

        // Partikel (hati dan bintang)
        function createParticles(x, y) {
            if (particles.length > 200) return; // Batasi maksimum 200 partikel
            for (let i = 0; i < 20; i++) {
                const isHeart = Math.random() < 0.5;
                particles.push({
                    x, y,
                    vx: (Math.random() - 0.5) * 8,
                    vy: (Math.random() - 0.5) * 8,
                    size: Math.random() * 6 + 3,
                    life: 40,
                    type: isHeart ? "heart" : "star",
                    color: ["#ff9aa2", "#b5fad7", "#c7ceea"][Math.floor(Math.random() * 3)]
                });
            }
        }

        function updateParticles() {
            particles = particles.filter(p => p.life > 0);
            particles.forEach(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
            });
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => {
                ctx.beginPath();
                if (p.type === "heart") {
                    const s = p.size;
                    ctx.moveTo(p.x, p.y - s * 0.5);
                    ctx.bezierCurveTo(p.x + s * 0.5, p.y - s, p.x + s, p.y, p.x, p.y + s);
                    ctx.bezierCurveTo(p.x - s, p.y, p.x - s * 0.5, p.y - s, p.x, p.y - s * 0.5);
                } else {
                    const s = p.size;
                    for (let i = 0; i < 10; i++) {
                        const r = i % 2 === 0 ? s : s * 0.5;
                        const a = (i * Math.PI) / 5;
                        ctx.lineTo(p.x + r * Math.cos(a), p.y + r * Math.sin(a));
                    }
                    ctx.closePath();
                }
                ctx.fillStyle = p.color;
                ctx.fill();
            });
        }

        // Membuat kucing
        function createCat() {
            if (cat) cat.remove();
            const mode = modes[currentMode];
            cat = document.createElement("div");
            cat.className = "cat";
            cat.style.width = mode.catSize + "px";
            cat.style.height = mode.catSize + "px";
            catData = {
                x: 400 - mode.catSize / 2,
                y: 300 - mode.catSize / 2,
                vx: 0,
                vy: 0,
                size: mode.catSize
            };
            cat.style.left = catData.x + "px";
            cat.style.top = catData.y + "px";
            cat.addEventListener("click", () => {
                if (!gameActive) return;
                clickCount++;
                const now = Date.now();
                let points = 1;
                if (now - lastClickTime < 500) points += 2;
                score += points;
                scoreDisplay.textContent = score;
                createParticles(catData.x + mode.catSize / 2, catData.y + mode.catSize / 2);
                cat.classList.add("clicked");
                setTimeout(() => cat.classList.remove("clicked"), 300);
                catData.vx = (Math.random() - 0.5) * mode.speed * 2;
                catData.vy = (Math.random() - 0.5) * mode.speed * 2;
                if (Math.random() < 0.3) playSound(meowSound);
                else playSound(clickSounds[clickCount % 2]);
                lastClickTime = now;
            });
            gameContainer.appendChild(cat);
        }

        // Update posisi kucing
        function updateCat() {
            if (!gameActive) return;
            catData.x += catData.vx;
            catData.y += catData.vy;
            if (catData.x <= 10 || catData.x >= 790 - catData.size) {
                catData.vx *= -1;
                catData.x = Math.max(10, Math.min(790 - catData.size, catData.x));
            }
            if (catData.y <= 10 || catData.y >= 590 - catData.size) {
                catData.vy *= -1;
                catData.y = Math.max(10, Math.min(590 - catData.size, catData.y));
            }
            cat.style.left = catData.x + "px";
            cat.style.top = catData.y + "px";
        }

        // Membuat gangguan (rubah)
        function spawnDistraction() {
            if (!gameActive || distractions.length >= modes[currentMode].distractionCount) return;
            const distraction = document.createElement("div");
            distraction.className = "distraction";
            const size = 50;
            distraction.style.width = `${size}px`;
            distraction.style.height = `${size}px`;
            let x, y;
            do {
                x = Math.random() * (800 - size);
                y = Math.random() * (600 - size);
            } while (Math.hypot(x - catData.x, y - catData.y) < size + catData.size);
            const vx = (Math.random() - 0.5) * 4;
            const vy = (Math.random() - 0.5) * 4;
            distraction.style.left = x + "px";
            distraction.style.top = y + "px";
            distraction.addEventListener("click", () => {
                if (!gameActive) return;
                score = Math.max(0, score - 5);
                scoreDisplay.textContent = score;
                playSound(distractionSound);
                distraction.remove();
                distractions = distractions.filter(d => d.element !== distraction);
            });
            gameContainer.appendChild(distraction);
            distractions.push({ element: distraction, x, y, vx, vy, size });
        }

        // Update posisi gangguan
        function updateDistractions() {
            if (!gameActive) return;
            distractions.forEach(d => {
                d.x += d.vx;
                d.y += d.vy;
                if (d.x <= 5 || d.x >= 795 - d.size) d.vx *= -1;
                if (d.y <= 5 || d.y >= 595 - d.size) d.vy *= -1;
                d.element.style.left = d.x + "px";
                d.element.style.top = d.y + "px";
            });
        }

        // Efek kabut
        function startFogEffect() {
            fogInterval = setInterval(() => {
                if (!gameActive) return;
                const mode = modes[currentMode];
                if (Math.random() < mode.fogChance) {
                    fog.style.display = "block";
                    setTimeout(() => {
                        if (gameActive) fog.style.display = "none";
                    }, mode.fogDuration);
                }
            }, 5000);
        }

        // Timer
        function startTimer() {
            timerId = setInterval(() => {
                if (timeLeft <= 0) {
                    clearInterval(timerId);
                    clearInterval(distractionInterval);
                    clearInterval(fogInterval);
                    cancelAnimationFrame(animationFrameId);
                    gameActive = false;
                    showLoadingScreen(() => {
                        gameOverScreen.style.display = "block";
                        finalScoreDisplay.textContent = score;
                        if (cat) cat.remove();
                        distractions.forEach(d => d.element.remove());
                        distractions = [];
                        particles = [];
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                    });
                } else {
                    timeLeft -= 0.1;
                    timeDisplay.textContent = Math.max(0, timeLeft).toFixed(1);
                }
            }, 100);
        }

        // Update game
        function gameLoop() {
            if (!gameActive) return;
            updateCat();
            updateDistractions();
            updateParticles();
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        // Tampilkan submenu mode
        function showModeSelect() {
            showLoadingScreen(() => {
                menu.style.display = "none";
                modeSelect.style.display = "block";
            });
        }

        // Mulai game
        function startGame(mode) {
            showLoadingScreen(() => {
                currentMode = mode;
                score = 0;
                timeLeft = modes[mode].time;
                clickCount = 0;
                lastClickTime = 0;
                gameActive = true;
                scoreDisplay.textContent = score;
                timeDisplay.textContent = timeLeft;
                gameOverScreen.style.display = "none";
                modeSelect.style.display = "none";
                gameContainer.style.display = "block";
                fog.style.display = "none";
                distractions.forEach(d => d.element.remove());
                distractions = [];
                particles = [];
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                createCat();
                distractionInterval = setInterval(spawnDistraction, 2000);
                startFogEffect();
                startTimer();
                gameLoop();
            });
        }

        // Kembali ke menu
        function backToMenu() {
            showLoadingScreen(() => {
                gameOverScreen.style.display = "none";
                gameContainer.style.display = "none";
                menu.style.display = "block";
                clearInterval(timerId);
                clearInterval(distractionInterval);
                clearInterval(fogInterval);
                cancelAnimationFrame(animationFrameId);
                if (cat) cat.remove();
                distractions.forEach(d => d.element.remove());
                distractions = [];
                particles = [];
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            });
        }

        // Load font Orbitron
        const link = document.createElement("link");
        link.href = "https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap";
        link.rel = "stylesheet";
        document.head.appendChild(link);
    </script>
</body>
  </html>
